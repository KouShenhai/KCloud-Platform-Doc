---
title: DDD落地之AQS原理篇（一）
date: 2024-03-02 14:00:47
permalink: /pages/b56e84/
---

你好呀，我的老朋友！我是老寇，欢迎来到老寇云平台！   
话不多说，跟我一起学习AQS。

###### 介绍
AQS全称```AbstractQueuedSynchronizer```（抽象队列同步器）

###### 原理
如果请求```共享资源空闲，则将当前请求资源的线程设置为有效的工作线程，并将共享资源设置为锁定状态```   
如果请求```共享资源被占用，暂时无法获取到锁的线程加入到队列中（需要一套线程阻塞等待以及被唤醒时锁分配的机制，CLH队列锁）```   

###### 1.CLH队列锁
虚拟的双向队列（不存在队列实例，仅存在结点之间的关联关系）  

我们一起画个简洁的图
<img src="/img/ddd/img_1.png" height='250'/>
<img src="/img/ddd/img_2.png" height='250'/>
 
我们一起学习```AQS源码```
```java
// 同步状态值
private volatile int state;
```
```state```表示同步状态，通过内置的```线程等待队列```来完成获取资源线程的排队工作

```java
    // 返回当前同步状态值
    protected final int getState() {
        return state;
    }
    
    // 设置同步状态值
    protected final void setState(int newState) {
        state = newState;
    }
    
    // 设置同步状态值（CAS操作）
    protected final boolean compareAndSetState(int expect, int update) {
        return U.compareAndSetInt(this, STATE, expect, update);
    }
```



## 参考资料
[JavaGuide](https://javaguide.cn/java/concurrent/java-concurrent-questions-03.html#aqs)   