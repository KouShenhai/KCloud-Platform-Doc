---
title: DDD落地之Seata Saga（一）
date: 2024-02-13 14:53:34
permalink: /pages/842323/
---

#### 介绍
Saga模式是Seata提供的长事务解决方案，在Saga模式中，业务流程中每个参与者都提交本地事务，当出现某一个参与者失败则补偿前面已经成功的参与者，一阶段正向服务和二阶段补偿服务都由业务开发实现。（摘抄Seata官网文档）
<img height="300" hight="300" src="/img/ddd/1.png"/>

#### XT、AT、TCC、SAGA区别
| 模式   | 使用场景                                                                                                         | 优点                                                              | 缺点                                                   |
|------|--------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|------------------------------------------------------|
| XT   | 1.标准的分布式事务处理模式<br/>2.使用两阶段提交协议<br/>3.适用于对一致性和隔离性有高要求的业务                                                      | 1.事务强一致性，满足ACID原则<br/>2.支持常用数据库，实现简单，没有代码侵入                     | 因为一阶段需要锁定数据库资源，等待二阶段结束才释放，所以性能较差                     |
| AT   | 1.无侵入的分布式解决方案<br/>2.适用于不希望对业务进行改造的场景<br/>3.每个本地事务都有一个与之对应的try和confirm方法<br/>4.如果所有本地事务都执行成功，则全局提交，否则回滚       | 1. 无侵入性，适用于不需要对业务进行改造的场景<br/>2.一阶段完成直接提交事务，释放数据库资源，性能较好         | 1.两阶段之间属于软状态，属于最终一致性<br/>2.框架的快照功能会影响性能，但比XA模式好很多    |
| TCC  | 1.高性能分布式解决方案<br/>2.适用于对性能有很高要求的场景<br/>3.用户需要根据业务场景实现try、confirm和cancel三个操作                                   | 1.一阶段完成直接提交事务，释放数据库资源，性能好<br/>2.相比AT模型，无需生成快照，无需使用全局锁，性能最强      | 1.代码有侵入，需要人为编写try、confirm和cancel接口<br/>2.软状态，事务是最终一致 |
| SAGA | 1.长事务解决方案<br/>2.适用于业务流程长且需要保证事务最终一致性的场景<br/>3.由多个参与者组成，每个参与者都是一个冲正补偿服务<br/>4.参与者包含其他公司或遗留系统服务，无法提供TCC要求的三个接口 | 1.事务参与者可以基于事件驱动实现异步调用，吞吐高<br/>2.一阶段直接提交事务，无锁，高性能<br/>3.补偿服务易于实现 | 1.软状态持续时间不确定，时效性差<br/>2.没有锁，不保证事务隔离性，会有脏读            |
这些模式各有优缺点，具体选择取决于业务需求和系统架构，在实际应用中，可以通过以下方式避免或减少分布式事务
- 减少分布式事务使用：尽可能将业务设计为本地事务，减少分布式事务的使用
- 使用最终一致性：在一些场景中，可以接受数据的最终一致性，而不是强一致性，这样可以使用性能更好的AT模式和SAGA模式
- 使用补偿事务：在TCC和SAGA模式中，可以通过编写补偿事务来处理事务失败的情况，保证数据的一致性
- 优化事务处理：在XT模式中，可以通过优化事务处理的方式提高性能，例如使用更高效的锁机制，减少锁的持有时间

#### 

## 参考资料
[Seata官网文档](https://seata.apache.org/zh-cn/docs/user/mode/saga)   